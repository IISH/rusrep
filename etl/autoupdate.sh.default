#!/bin/bash

# FL-27-Sep-2017 Created
# FL-27-May-2019 Changed

echo "autoupdate.sh" > autoupdate.sh.log
echo `date` >> autoupdate.sh.log

echo "user:" $USER >> autoupdate.sh.log
if [[ $(id -u) -eq 0 ]] ; 	# cron job runs as root
	then  su - <USER> ;		# run the update as user <USER>
	echo "user:" $USER >> autoupdate.sh.log
fi

PY_VER="$(python -V 2>&1)"
echo "system  python:" $PY_VER >> autoupdate.sh.log
# choose your virtual python: 
export PYTHON_HOME=<VIRTUAL_PYTHON_HOME>
# activate the virtualenv python
source $PYTHON_HOME/bin/activate
PY_VER="$(python -V 2>&1)"
echo "virtual python:" $PY_VER
echo "virtual python:" $PY_VER >> autoupdate.sh.log

export RUSREPO_HOME=<RUSREPO_HOME>
echo "RUSREPO_HOME:" $RUSREPO_HOME >> autoupdate.sh.log

CONFIG_DIR=${RUSREPO_HOME}/config
export RUSSIANREPO_CONFIG_PATH=${CONFIG_DIR}/russianrepo.config
echo "RUSSIANREPO_CONFIG_PATH:" $RUSSIANREPO_CONFIG_PATH >> autoupdate.sh.log

cd $RUSREPO_HOME/etl
python autoupdate.py

if [ $? -eq 0 ]
then
    echo "autoupdate.py done" >> autoupdate.sh.log
    exit 0
else
    echo "error in autoupdate.py" >> autoupdate.sh.log
    exit 1
fi

